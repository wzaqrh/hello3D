<!DOCTYPE html>
<!-- saved from url=(0056)https://gitbook.corp.sdo.com/serverbook/programming.html -->
<html lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
        
        <title>编程语言 · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="./编程语言 · GitBook_files/style.css">

    
            
                
                <link rel="stylesheet" href="./编程语言 · GitBook_files/website.css">
                
            
                
                <link rel="stylesheet" href="./编程语言 · GitBook_files/search.css">
                
            
                
                <link rel="stylesheet" href="./编程语言 · GitBook_files/website(1).css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://gitbook.corp.sdo.com/serverbook/gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="https://gitbook.corp.sdo.com/serverbook/gitbook/images/favicon.ico" type="image/x-icon">

    
    
    
    

    <style></style><link rel="prev" href="https://gitbook.corp.sdo.com/serverbook/gdb.html"><link rel="next" href="https://gitbook.corp.sdo.com/serverbook/stl.html"></head>
    <body>
        
<div class="book without-animation with-summary font-size-2 font-family-1">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search">
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/">
            
                    
                    目录
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="linux.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/linux.html">
            
                    
                    Linux使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="gdb.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/gdb.html">
            
                    
                    gdb使用
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.1.3" data-path="programming.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/programming.html">
            
                    
                    编程语言
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4" data-path="stl.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/stl.html">
            
                    
                    STL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.5" data-path="multi-thread.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/multi-thread.html">
            
                    
                    多线程编程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6" data-path="data-structure.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/data-structure.html">
            
                    
                    数据结构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7" data-path="mysql/">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/mysql/">
            
                    
                    数据库
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.7.1" data-path="mysql/2nf.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/mysql/2nf.html">
            
                    
                    第二范式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7.2" data-path="mysql/introduction.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/mysql/introduction.html">
            
                    
                    mysql 数据类型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7.3" data-path="mysql/sql_README.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/mysql/sql_README.html">
            
                    
                    基本 sql 语句
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.7.3.1" data-path="mysql/sql_select.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/mysql/sql_select.html">
            
                    
                    SQL SELECT 语句
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7.3.2" data-path="mysql/sql_where.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/mysql/sql_where.html">
            
                    
                    SQL WHERE 子句
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7.3.3" data-path="mysql/sql_and_or.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/mysql/sql_and_or.html">
            
                    
                    SQL AND &amp; OR 运算符
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7.3.4" data-path="mysql/sql_order_by.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/mysql/sql_order_by.html">
            
                    
                    SQL ORDER BY 子句
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7.3.5" data-path="mysql/sql_insert.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/mysql/sql_insert.html">
            
                    
                    SQL INSERT INTO 语句
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7.3.6" data-path="mysql/sql_update.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/mysql/sql_update.html">
            
                    
                    SQL UPDATE 语句
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7.3.7" data-path="mysql/sql_delete.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/mysql/sql_delete.html">
            
                    
                    SQL DELETE 语句
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7.3.8" data-path="mysql/sql_like.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/mysql/sql_like.html">
            
                    
                    SQL LIKE 操作符
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7.3.9" data-path="mysql/sql_wildcard.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/mysql/sql_wildcard.html">
            
                    
                    SQL 通配符
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7.3.10" data-path="mysql/sql_between.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/mysql/sql_between.html">
            
                    
                    SQL BETWEEN 操作符
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7.3.11" data-path="mysql/sql_create_db.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/mysql/sql_create_db.html">
            
                    
                    SQL CREATE DATABASE 语句
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7.3.12" data-path="mysql/sql_create_tb.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/mysql/sql_create_tb.html">
            
                    
                    SQL CREATE TABLE 语句
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7.3.13" data-path="mysql/sql_not_null.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/mysql/sql_not_null.html">
            
                    
                    SQL NOT NULL 约束
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7.3.14" data-path="mysql/sql_unique.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/mysql/sql_unique.html">
            
                    
                    SQL UNIQUE 约束
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7.3.15" data-path="mysql/sql_primary_key.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/mysql/sql_primary_key.html">
            
                    
                    SQL PRIMARY KEY 约束
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7.3.16" data-path="mysql/sql_default.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/mysql/sql_default.html">
            
                    
                    SQL DEFAULT 约束
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7.3.17" data-path="mysql/sql_create_idx.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/mysql/sql_create_idx.html">
            
                    
                    SQL CREATE INDEX 语句
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7.3.18" data-path="mysql/sql_alter_tb.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/mysql/sql_alter_tb.html">
            
                    
                    SQL ALTER TABLE 语句
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7.3.19" data-path="mysql/sql_auto_incr.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/mysql/sql_auto_incr.html">
            
                    
                    SQL AUTO INCREMENT 字段
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7.3.20" data-path="mysql/sql_group_by.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/mysql/sql_group_by.html">
            
                    
                    SQL GROUP BY 语句
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.1.8" data-path="networking-programming.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/networking-programming.html">
            
                    
                    网络编程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.9" data-path="game-programming.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/game-programming.html">
            
                    
                    游戏编程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.10" data-path="cmake.html">
            
                <a href="https://gitbook.corp.sdo.com/serverbook/cmake.html">
            
                    
                    CMake使用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com/" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <a class="btn pull-left js-toolbar-action" aria-label="" href="https://gitbook.corp.sdo.com/serverbook/programming.html#"><i class="fa fa-align-justify"></i></a><div class="dropdown pull-right js-toolbar-action"><a class="btn toggle-dropdown" aria-label="Share" href="https://gitbook.corp.sdo.com/serverbook/programming.html#"><i class="fa fa-share-alt"></i></a><div class="dropdown-menu dropdown-left"><div class="dropdown-caret"><span class="caret-outer"></span><span class="caret-inner"></span></div><div class="buttons"><button class="button size-5 ">Facebook</button><button class="button size-5 ">Google+</button><button class="button size-5 ">Twitter</button><button class="button size-5 ">Weibo</button><button class="button size-5 ">Instapaper</button></div></div></div><a class="btn pull-right js-toolbar-action" aria-label="" href="https://gitbook.corp.sdo.com/serverbook/programming.html#"><i class="fa fa-facebook"></i></a><a class="btn pull-right js-toolbar-action" aria-label="" href="https://gitbook.corp.sdo.com/serverbook/programming.html#"><i class="fa fa-twitter"></i></a><div class="dropdown pull-left font-settings js-toolbar-action"><a class="btn toggle-dropdown" aria-label="Font Settings" href="https://gitbook.corp.sdo.com/serverbook/programming.html#"><i class="fa fa-font"></i></a><div class="dropdown-menu dropdown-right"><div class="dropdown-caret"><span class="caret-outer"></span><span class="caret-inner"></span></div><div class="buttons"><button class="button size-2 font-reduce">A</button><button class="button size-2 font-enlarge">A</button></div><div class="buttons"><button class="button size-2 ">Serif</button><button class="button size-2 ">Sans</button></div><div class="buttons"><button class="button size-3 ">White</button><button class="button size-3 ">Sepia</button><button class="button size-3 ">Night</button></div></div></div><h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="https://gitbook.corp.sdo.com/serverbook/">编程语言</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p>﻿## C++编程语言</p>
<h3 id="基本概念">基本概念</h3>
<p>参考<strong>C++程序设计语言</strong>或者<strong>C++ Primer</strong></p>
<h3 id="编码风格">编码风格</h3>
<p>已经存在项目按照项目老的风格来编写. 新项目可以参考一下<strong>Google Cpp Style Guide</strong></p>
<p>Linux下有一个工具<strong>clang-format</strong>, 给定.clang-format文件之后, 可以按照该格式帮你格式化代码, 该工具支持多种代码风格, 也可以自己编辑.clang-format文件自定义风格</p>
<h3 id="一些比较常用的知识点">一些比较常用的知识点</h3>
<ol>
<li><p>内联函数</p>
<p>写在class声明的函数会被inline, 也可以在头文件内手动提供inline关键字, 还可以在cpp内提供static修饰非成员函数</p>
</li>
<li><p>隐式转换</p>
<p>C++继承自C语言最大的缺陷就是隐式转换, 高质量的编程需要控制隐式转换, 让程序员自己去显式的转换, 尽量可能让编译器报错</p>
<p>C++11提供<code>explicit bool()</code>用来做显式的object到bool类型的转换, 防止int类型到bool类型的隐式转换</p>
</li>
<li><p>覆盖</p>
<p>子类会覆盖父类的同名函数, 不管是不是真的想去override同名函数, 这个有时候会导致一些很奇怪的BUG</p>
<pre><code class="lang-C++"> <span class="hljs-keyword">struct</span> Base {
     <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">f</span><span class="hljs-params">()</span> </span>{ 
         <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"base::f"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
     }
 };

 <span class="hljs-keyword">struct</span> Dervided : <span class="hljs-keyword">public</span> Base {
     <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">f</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
         <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Dervided::f"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
     }
 };
</code></pre>
<p> 上面这个例子里面<code>Dervided</code>覆盖了父类的<code>f</code>成员函数, 但是并不是我们理解的<code>override</code>. 所以如我们如果要的override, 在<code>C++03</code>里面就需要注意了, 在<code>C++11</code>里面可以添加<code>override</code>关键字, 防止错误的覆盖, 提早发现问题.</p>
</li>
<li><p>const</p>
<p>const关键字在修饰变量的时候实际上是readonly, 在写库的时候, 有时候需要placement new来修改const成员</p>
<p>在修饰成员函数的时候, 是表示该成员函数不能修改类成员变量.</p>
<p>如果在const成员函数内部修改修改类成员变量, 那么可以在该类的成员变量声明的地方增加mutable关键字.</p>
</li>
<li><p>std::string</p>
<p>C风格的string是以'\0'结尾, C++的std::string并不是这样, 自身包含<strong>长度</strong>, 可以用来存储很多种类型的数据.</p>
<p>现代风格的C++尽量少使用C风格的string, 性能低下而且不安全.</p>
</li>
<li><p>printf</p>
<p>printf系列函数, 例如snprintf等, 格式化字符串一定得是常量, 不能是动态的内容, 不能从策划配置里面获取.</p>
<pre><code class="lang-C++"> <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* format = <span class="hljs-string">"%s\n"</span>;    <span class="hljs-comment">//这个format如果是动态生成的, 就会躲过编译器检测</span>
 <span class="hljs-built_in">printf</span>(format, <span class="hljs-number">1</span>);              <span class="hljs-comment">//有可能产生宕机</span>
</code></pre>
</li>
<li>注意STL迭代器是否失效</li>
<li><p>auto</p>
<p>C++11提供了一个auto关键字, 用来做编译时期的类型推断, 可以用来简化复杂类型的代码编写.</p>
<p>但是需要注意, 你需要值还是引用类型. 例如迭代器类型, 就是按照值来拷贝; 但是大部分场景, 我们需要的都是<code>auto&amp;</code>或者<code>const auto&amp;</code>.</p>
<pre><code class="lang-C++"> <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span>&amp; pair:<span class="hljs-built_in">map</span>) {   <span class="hljs-comment">//这边如果少写了&amp;, 可能就不是你想要的值了, 做了一次拷贝</span>
     <span class="hljs-comment">///...</span>
 }
</code></pre>
</li>
<li></li>
</ol>
<h3 id="raii">RAII</h3>
<p>C++一个非常重要的概念, 用来编写安全的代码.</p>
<ol>
<li>合理使用Noncopyable机制, 具有ID的实例是不可以被拷贝的</li>
<li>对象的内部使用shared_ptr/weak_ptr来做浅拷贝, 深拷贝按照自己的需求实现</li>
<li>将硬件资源(File/Handle等)通过shared_ptr封装, 提供Deleter方法, 避免对硬件资源直接使用裸指针从而导致资源生命周期管理复杂化</li>
</ol>
<p>例如:</p>
<pre><code class="lang-C++"><span class="hljs-comment">//不可以拷贝的对象</span>
<span class="hljs-keyword">class</span> Noncopyable {
 <span class="hljs-keyword">protected</span>:
  Noncopyable() = <span class="hljs-keyword">default</span>;
  ~Noncopyable() = <span class="hljs-keyword">default</span>;

 <span class="hljs-keyword">private</span>:
  Noncopyable(<span class="hljs-keyword">const</span> Noncopyable&amp;) = <span class="hljs-keyword">delete</span>;
  Noncopyable&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-keyword">const</span> Noncopyable&amp;) = <span class="hljs-keyword">delete</span>;
};

<span class="hljs-comment">//玩家是不可以拷贝的</span>
<span class="hljs-comment">//同一个进程内如果有多个同一ID的玩家, 会引起各种bug</span>
<span class="hljs-keyword">class</span> Player : Noncopyable {
<span class="hljs-keyword">public</span>:
   Player(<span class="hljs-keyword">int32_t</span> player_id);
<span class="hljs-keyword">private</span>:
   ...
};

<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;FILE&gt;&amp; file =
    <span class="hljs-built_in">std</span>::make_shared&lt;FILE&gt;(fopen(<span class="hljs-string">"./a.txt"</span>, <span class="hljs-string">"a+"</span>), 
                           [](FILE* f) { fclose(f); });
</code></pre>
<h3 id="指针和引用">指针和引用</h3>
<p>指针和引用在实现上区别不大, 主要在于使用上的区别.</p>
<ol>
<li>指针需要判空</li>
<li>引用需要初始化</li>
</ol>
<p>一旦可以确定指针非空之后, 可以将后续的依赖全部替换成引用, 方便代码的编写</p>
<h3 id="传递参数">传递参数</h3>
<ol>
<li>一般的参数传值, 大小可控的值对象POD也可传值(x64 abi会优先使用寄存器)</li>
<li>复杂对象传递引用, 不会修改的传递const引用(或者指针)</li>
<li>可空对象传递指针, 否则就传递引用</li>
<li>智能指针传递const引用(减少不必要的计数器消耗)</li>
<li>闭包传参需要注意对象生命周期, 尤其是this的生命周期</li>
</ol>
<h3 id="虚函数和function">虚函数和function</h3>
<p>虚函数可以实现比较灵活设计, 但是会有一定的心智负担, 会存在大量的继承关系. </p>
<p>C++11的function可以在一定程度上减轻虚函数的使用, 还可以保证高性能, 已经灵活性, 可以考虑将一些不必要的虚函数替换成function.</p>
<h3 id="现代风格的资源管理">现代风格的资源管理</h3>
<p>老式风格的C/C++程序内会存在大量的new/delete, 甚至malloc/free. 这种内存管理会导致大量的bug, 而且比较难管理对象的生命周期.</p>
<p>如果只有兼容<code>C++03</code>的编译器, 推荐使用boost的智能指针来管理资源
如果有<code>C++11</code>以上的的编译器, 可以使用shared_ptr/weak_ptr来管理资源.</p>
<ol>
<li>尽量做到只有一个管理者持有该资源</li>
<li>同步调用传递<code>const shared_ptr&lt;T&gt;&amp;</code></li>
<li>异步调用传递<code>weak_ptr&lt;T&gt;</code>, 然后<code>lock</code>获取shared_ptr</li>
<li>shared_ptr持有其他资源尽量使用ID或者weak_ptr, 避免环状依赖</li>
</ol>
<p>这样</p>
<ol>
<li>删除一个资源只需要从管理者那边移除引用即可, 不会造成内存泄漏</li>
<li>获取一个对象不是shared_ptr就是weak_ptr, 后者只需要lock一下, 就可以拿到资源</li>
<li>每次使用资源之前注意判断shared_ptr的有效性, 防止出现空指针调用</li>
</ol>
<p>如果需要move语义的指针, 可以使用unique_ptr. 不过目前看到的场景不多.</p>
<h3 id="模板编程">模板编程</h3>
<p>模板可以做到编译时期的代码生成, 与宏不一样的是, 模板可以针对具体类型编程(强类型), 还可以通过特化和片特化, 给某一些类型赋予不一样的行为.</p>
<h4 id="使用模板">使用模板</h4>
<p>大部分需求都是通过使用模板来实现的, 例如使用STL和boost这两种.</p>
<p>针对STL, 可以通过Effective STL等一系列书, 还有STL的手册例如cpp reference等, 可以掌握的比较熟练;</p>
<p>boost可以查看boost的官方文档.</p>
<h4 id="编写模板">编写模板</h4>
<p>编写模板的时候, 需要先做抽象, 你的类型<code>T</code>是不是有一定的特征, 这种特征能不能通过继承来实现, 能不能通过重载来实现. 这是需要考虑的问题.</p>
<p>如果不能通过继承来实现, 而且不想以后不停的修改实现(重载), 那么可以考虑写模板函数或者模板类. 例如一个小端的StreamWrite, 用来Append各种类型的Value:</p>
<pre><code class="lang-C++"><span class="hljs-keyword">class</span> StreamWrite {
<span class="hljs-keyword">public</span>:
  <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Append</span><span class="hljs-params">(<span class="hljs-keyword">const</span> T&amp; v)</span> </span>{
    <span class="hljs-keyword">this</span>-&gt;Append(&amp;v, <span class="hljs-keyword">sizeof</span> v);
  }

  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Append</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span>* d, <span class="hljs-keyword">int</span> size)</span> </span>{
     ...
  }
<span class="hljs-keyword">private</span>:
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> content_;
};
</code></pre>
<p>这里的模板函数<code>Append</code>, 就可以用来追加各种类型的值, 而避免编写各种类型的重载, 节省工作量. 当然这只是一个例子, 不是完全正确, 例如我想追加<code>std::string</code>, 那么这种写法肯定就是错误的.</p>
<p>所以实际编写模板类或者模板函数的时候, 需要使用<code>traits</code>这个概念. 具体可以看<a href="https://gitbook.corp.sdo.com/serverbook/en.cppreference.com/w/cpp/types">Cpp Reference Traits</a>章节. 如果是C++03, 则需要使用boost库的traits.</p>
<h4 id="模板的特化和片特化">模板的特化和片特化</h4>
<p>这是上一个标题的补充, 有的时候需要这种技术.</p>
<p>我们针对类型<code>T</code>编写了模板, 是可以满足绝大部分类型上面的需求, 但是有一个特别的类型<code>T1</code>不满足, 需要做单独的特殊处理, 这时候就需要模板的特化和片特化. 这个概念和我们在处理一个数字是类似的, 这个数字大部分时刻均是这么处理, 等于0的时候又是那么处理. 只不过这里将数字替换成了类型. 这个概念叫<code>模式匹配</code>.</p>
<p>例如一个常见的需求, 对自定义类型ComplexKey做<code>std::hash</code>的特化. 标准库只是对各种内置的类型做了<code>std::hash</code>的特化, 想要使用<code>std::unoredered_map</code>, 那么就需要这么搞一下:</p>
<pre><code class="lang-C++"><span class="hljs-keyword">struct</span> ComplexKey {
  <span class="hljs-keyword">int</span> key1;
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> key2;
};

<span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span> {
  <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">hash_combine</span><span class="hljs-params">(size_t&amp; seed, <span class="hljs-keyword">const</span> T&amp; v)</span></span>{
    seed ^= <span class="hljs-built_in">std</span>::hash&lt;T&gt;(v) + <span class="hljs-number">0x9e3779b9</span> + (seed &lt;&lt; <span class="hljs-number">6</span>) + (seed &gt;&gt; <span class="hljs-number">2</span>);
  }

  <span class="hljs-keyword">template</span>&lt;&gt;
  <span class="hljs-keyword">struct</span> hash&lt;ComplexKey&gt; {
    <span class="hljs-keyword">size_t</span> <span class="hljs-keyword">operator</span>()(<span class="hljs-keyword">const</span> ComplexKey&amp; k) <span class="hljs-keyword">const</span> {
        <span class="hljs-keyword">size_t</span> s = <span class="hljs-number">0</span>;
        <span class="hljs-built_in">std</span>::hash_combine(s, k.key1);
        <span class="hljs-built_in">std</span>::hash_combine(s, k.key2);
        <span class="hljs-keyword">return</span> s;
    }
  };
}
</code></pre>
<p>对于多余一个类型参数的模板类, 我们还可以单独特化某一个类型, 或者全部类型, 前者叫偏特化, 后者叫全特化. 具体可以参考C++ Templates这本书做深入了解.</p>
<h4 id="元编程">元编程</h4>
<p>不推荐元编程, 过于复杂, 新的编程语言例如Java/C#等, 均不提供元编程的能力, 都止步于普通的模板.</p>
<h2 id="参考资料">参考资料</h2>
<ol>
<li><a href="https://item.jd.com/11306138.html" target="_blank">C++ Primer</a></li>
<li><a href="https://item.jd.com/11986384.html" target="_blank">C++程序设计语言</a></li>
<li><a href="https://item.jd.com/10393318.html" target="_blank">Effective C++</a></li>
<li><a href="https://item.jd.com/10484020.html" target="_blank">More Effective C++</a></li>
<li><a href="https://item.jd.com/11789230.html" target="_blank">Effective Modern C++</a></li>
<li>C++语言的设计与演化</li>
<li><a href="https://item.jd.com/11253409.html" target="_blank">Effective STL</a></li>
<li><a href="https://clang.llvm.org/docs/ClangFormat.html" target="_blank">clang format</a></li>
<li><a href="https://google.github.io/styleguide/cppguide.html" target="_blank">Google Cpp Style Guide</a></li>
<li><a href="http://en.cppreference.com/w/" target="_blank">cpp reference</a></li>
<li><a href="https://item.jd.com/11216941.html" target="_blank">C++ Templates</a></li>
</ol>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class="search-results-count"></span> results matching "<span class="search-query"></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class="search-query"></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="https://gitbook.corp.sdo.com/serverbook/gdb.html" class="navigation navigation-prev " aria-label="Previous page: gdb使用">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="https://gitbook.corp.sdo.com/serverbook/stl.html" class="navigation navigation-next " aria-label="Next page: STL" style="margin-right: 0px;">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"编程语言","level":"1.1.3","depth":2,"next":{"title":"STL","level":"1.1.4","depth":2,"path":"stl.md","ref":"stl.md","articles":[]},"previous":{"title":"gdb使用","level":"1.1.2","depth":2,"path":"gdb.md","ref":"gdb.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"programming.md","mtime":"2019-04-24T05:51:13.433Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-11-22T03:40:26.755Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="./编程语言 · GitBook_files/gitbook.js.下载"></script>
    <script src="./编程语言 · GitBook_files/theme.js.下载"></script>
    
        
        <script src="./编程语言 · GitBook_files/search-engine.js.下载"></script>
        
    
        
        <script src="./编程语言 · GitBook_files/search.js.下载"></script>
        
    
        
        <script src="./编程语言 · GitBook_files/lunr.min.js.下载"></script>
        
    
        
        <script src="./编程语言 · GitBook_files/search-lunr.js.下载"></script>
        
    
        
        <script src="./编程语言 · GitBook_files/buttons.js.下载"></script>
        
    
        
        <script src="./编程语言 · GitBook_files/fontsettings.js.下载"></script>
        
    

    


</body></html>